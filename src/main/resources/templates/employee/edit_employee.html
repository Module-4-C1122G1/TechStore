<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="/home/home :: head"></head>
<head>
    <meta charset="UTF-8">
    <title>Chỉnh Sửa Nhân Viên</title>
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <link rel="stylesheet" th:href="@{/css/createProduct.css}">
</head>
<body>
<div class="header" th:replace="/home/home :: header"></div>
<div class="main d-flex justify-content-center align-items-center mt-5">
    <div aria-atomic="true" aria-live="assertive" class="toast show" role="alert" th:if="${msgSuccess != null}">
        <div class="toast-header bg-warning">
            <strong class="me-auto">Thông báo</strong>
            <small>1 second ago</small>
            <button aria-label="Close" class="btn-close" data-bs-dismiss="toast" type="button"></button>
        </div>
        <div class="toast-body" th:text="${msgSuccess}">
        </div>
    </div>
    <div aria-atomic="true" aria-live="assertive" class="toast show" role="alert" th:if="${msgError != null}">
        <div class="toast-header bg-danger">
            <strong class="me-auto">Thông báo</strong>
            <small>1 second ago</small>
            <button aria-label="Close" class="btn-close" data-bs-dismiss="toast" type="button"></button>
        </div>
        <div class="toast-body" th:text="${msgError}">
        </div>
    </div>
    <form class="d-flex flex-column" id="form-login" th:action="@{/admin/employee/edit}" method="post"
          th:object="${employeeDTO}">
        <h2 class="text-center" style="color: #212529;font-size: 20px;
        font-weight: 500; padding: 10px 24px;">Chỉnh Sửa Nhân Viên</h2>
        <input type="hidden" class="mb-3 username" th:field="${employeeDTO.id}">
        <label for="nameEmployee" class="fw-bold">Điền Tên Nhân Viên : <span style="color: red">*</span></label>
        <input class="mb-3 username" type="text" th:field="*{nameEmployee}" name="nameEmployee" id="nameEmployee">
        <span style="color: red" th:if="${#fields.hasErrors('nameEmployee')}" th:errors="*{nameEmployee}"></span>

        <label for="phoneNumber" class="fw-bold">Điền Số Điện Thoại : <span style="color: red">*</span></label>
        <input type="text" class="mb-3 username" th:field="*{phoneNumber}" name="phoneNumber" id="phoneNumber">
        <span style="color: red" th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}"></span>

        <label for="dateOfBirth" class="fw-bold">Điền Ngày Sinh : <span style="color: red">*</span></label>
        <input type="date" class="mb-3 username" th:field="*{dateOfBirth}" name="dateOfBirth" id="dateOfBirth">
        <span style="color: red" th:if="${#fields.hasErrors('dateOfBirth')}" th:errors="*{dateOfBirth}"></span>

        <label th:text="${'Thành phố:'}" class="fw-bold"></label><select class="username" id="city" name="city"
                                                                         th:onclick="selectDistrict()"></select>
        <label th:text="${'Quận huyện:'}" class="fw-bold"></label><select class="username" id="district" name="district"
                                                                          th:onclick="selectTown()"
                                                                          th:text="${'--Quận huyện--'}">--Quận
        huyện--</select>
        <label th:text="${'Xã, phường:'}" class="fw-bold"></label><select class="username mb-3" id="town" name="town"
                                                                          th:text="${'--Xã phường--'}"></select>
        <input id="address" name="address" type="hidden">
        <label class="fw-bold">Chức Vụ :</label>
        <select class="username" th:field="*{position}">
            <option th:each="position : ${positionList}" th:text="${position.namePosition}"
                    th:value="${position.id}"></option>
        </select>
        <label class="fw-bold ">Phòng Ban :</label>
        <select class="username" th:field="*{department}">
            <option th:each="department : ${departmentList}" th:text="${department.nameDepartment}"
                    th:value="${department.id}"></option>
        </select>
        <label class="fw-bold">Giới Tính :</label>
        <select class="username" th:field="*{gender}">
            <option th:each="gender : ${genderList}" th:text="${gender.nameGender}" th:value="${gender.id}"></option>
        </select>
        <div class="mt-3">
            <input type="submit" class="btn btn-danger fw-bold" value="Xác Nhận">
            <button type="button" class="btn btn-secondary" onclick="window.location.href='/admin/employee'">Hủy Bỏ
            </button>
        </div>
    </form>
</div>
<div class="site-footer" th:replace="/home/home :: footer"></div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
    window.onload = function () {
        selectCity();
    }

    async function selectCity() {
        const response = await fetch("https://provinces.open-api.vn/api/");
        const jsonData = await response.json();
        document.getElementById("city").innerHTML = jsonData.map((city, index) => {
            return `
                <option value="${city.code}">${city.name}</option>
            `
        })
    }

    async function selectDistrict() {
        let idCity = document.getElementById("city").value;
        console.log(idCity);
        const response = await fetch("https://provinces.open-api.vn/api/p/" + idCity + "?depth=2");
        const jsonData = await response.json();
        document.getElementById("district").innerHTML = jsonData.districts.map((distinct, index) => {
            return `
                <option value="${distinct.code}">${distinct.name}</option>
            `
        })
    }

    async function selectTown() {
        let idDistrict = document.getElementById("district").value;
        console.log(idDistrict);
        const response = await fetch("https://provinces.open-api.vn/api/d/" + idDistrict + "?depth=2");
        const jsonData = await response.json();
        console.log(jsonData)
        document.getElementById("town").innerHTML = jsonData.wards.map((ward, index) => {
            return `
                <option value="${ward.code}">${ward.name}</option>
            `
        })
    }

    document.getElementById("town").onchange = () => {
        console.log("change")
        let townElm = document.getElementById("town")
        let districtElm = document.getElementById("district")
        let cityElm = document.getElementById("city")
        document.getElementById("address").value
            = townElm.options[townElm.selectedIndex].text + ", " + districtElm.options[districtElm.selectedIndex].text + ", " + cityElm.options[cityElm.selectedIndex].text;
        console.log(document.getElementById("address").value);
    }
</script>
<script>
    setTimeout(() => {
        let toast = document.getElementsByClassName("toast")[0];
        toast.style.transform = "translate("+0+"," + 100 + "%)";
        toast.style.opacity = 0;
        toast.style.transition = 0.5+"s transform, "+ 1 + "s opacity";
    }, 2500);
</script>
</body>
</html>